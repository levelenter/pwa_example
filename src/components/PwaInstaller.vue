<template>
  <div>
    <button
      v-if="!is_iOS"
      class="btn btn-lg btn-outline-secondary h-25 w-100 align-middle"
      @click="installBnr"
    >
      インストールする
    </button>
  </div>
</template>

<script>
import { defineComponent, ref } from "vue";
import AddToHomeScreen from "a2hs.js";
import MobileDetect from "mobile-detect";

const mb = new MobileDetect(window.navigator.userAgent);

export default defineComponent({
  components: {},
  setup: () => {
    const is_iOS = ref(mb.os() === "iOS");
    console.log("ios", mb.os(), mb);
    const installBnr = () => {
      let deferredPrompt;

      window.addEventListener("beforeinstallprompt", (e) => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;
        deferredPrompt.prompt();
      });
    };
    return {
      installBnr,
      is_iOS,
    };
  },
});

/**
 * Simple (with default config) init
 */
if (mb.os() === "iOS") {
  AddToHomeScreen();
}

/**
 * Advanced (with your config) init
 */
AddToHomeScreen({
  brandName: "Pwa-Demo",
  fontFamily: "Tahoma, sans-serif",
  htmlContent: `PWA-DEMOをiOSにインストールするには↓の<img style="width:2rem;height:2rem" src="https://img.icons8.com/ios-glyphs/30/000000/share-rounded.png"/>をタップして
  <strong>ホーム画面に追加
  <img style="width:2rem;height:2rem" src="https://img.icons8.com/external-becris-lineal-becris/64/000000/external-add-mintab-for-ios-becris-lineal-becris.png"/></strong>を選択してください `,
  // ... see full list of config options below
  logoImage: `<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
 "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="64.000000pt" height="64.000000pt" viewBox="0 0 512.000000 512.000000"
 preserveAspectRatio="xMidYMid meet">

<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M1746 3504 c-179 -44 -335 -199 -375 -374 -64 -278 124 -560 409
-611 72 -12 100 -9 100 14 0 9 -25 17 -76 25 -277 43 -457 305 -389 565 23 87
61 155 126 219 71 71 155 113 262 130 61 9 77 15 75 27 -4 21 -58 24 -132 5z"/>
<path d="M1767 3410 c-58 -15 -135 -57 -181 -101 -46 -42 -106 -143 -106 -178
0 -39 28 -21 53 33 124 271 483 285 643 25 52 -84 89 -77 45 9 -36 70 -108
139 -185 178 -61 30 -86 36 -152 39 -44 3 -96 0 -117 -5z"/>
<path d="M3390 3211 c-29 -16 -36 -26 -40 -57 l-5 -39 -82 -7 c-46 -4 -86 -9
-90 -11 -9 -6 -150 16 -211 32 -74 20 -131 16 -196 -14 -47 -22 -81 -30 -170
-36 -270 -21 -320 -21 -385 -6 -35 8 -70 13 -78 10 -7 -3 -13 -20 -13 -42 0
-27 8 -45 31 -69 36 -39 66 -52 117 -52 20 0 55 -7 77 -15 47 -17 113 -19 150
-5 26 10 26 9 20 -19 -6 -29 7 -69 27 -82 5 -3 11 -18 12 -32 3 -29 31 -77 45
-77 5 0 11 -16 14 -34 9 -54 37 -106 67 -121 23 -12 36 -12 96 2 85 19 86 19
154 -1 80 -23 109 -20 195 20 69 33 80 36 112 26 20 -6 40 -9 45 -6 5 3 135 5
289 5 254 -1 279 0 279 15 0 16 -15 17 -167 11 -185 -7 -218 -1 -218 42 l0 23
185 5 c198 4 214 6 207 26 -3 9 -56 12 -223 12 l-219 0 -6 140 c-3 77 -12 173
-18 213 -12 65 -11 75 4 98 16 25 19 26 83 18 80 -11 169 -10 275 1 64 6 77
11 75 24 -4 19 -49 19 -140 0 -52 -11 -141 -5 -243 16 -11 3 -36 -4 -55 -14z
m-425 -117 c39 -8 95 -20 126 -25 l56 -11 7 -51 c3 -29 6 -113 6 -188 0 -137
6 -161 40 -171 15 -5 -92 -69 -148 -89 -54 -19 -133 4 -191 57 -51 45 -68 51
-102 34 -34 -18 -23 -39 23 -42 63 -5 58 -24 -9 -38 -65 -14 -79 -9 -107 39
-26 44 -12 71 60 113 65 38 84 65 38 54 -16 -4 -49 -20 -74 -36 -39 -26 -47
-28 -65 -16 -49 32 -23 70 76 114 51 22 71 42 42 42 -25 0 -99 -27 -129 -46
-30 -20 -54 -12 -54 20 0 17 7 27 23 31 36 11 147 86 141 96 -9 16 -40 10 -70
-13 -23 -18 -42 -23 -94 -23 -36 -1 -76 -7 -89 -14 -27 -15 -87 -8 -132 14
-15 8 -48 15 -73 15 -51 0 -106 37 -106 72 0 17 4 19 28 14 121 -28 145 -29
230 -18 48 6 135 14 194 18 89 5 118 11 165 34 68 33 93 35 188 14z m391 -41
c4 -10 9 -93 12 -185 l4 -167 -34 -6 c-18 -3 -55 -6 -83 -8 l-50 -2 -9 177
c-5 97 -6 184 -3 192 10 25 152 23 163 -1z m69 -400 c3 -14 2 -29 -2 -33 -4
-4 -43 -10 -86 -12 -69 -5 -79 -3 -88 14 -15 28 -5 34 63 42 34 3 66 10 71 15
15 15 35 2 42 -26z"/>
<path d="M3252 2778 c-28 -28 -3 -72 39 -66 30 4 47 33 33 56 -14 21 -55 27
-72 10z"/>
<path d="M1935 3121 l-30 -6 -3 -91 c-3 -116 6 -127 75 -93 66 34 70 54 8 45
-61 -10 -58 14 4 29 51 13 54 29 6 33 -64 6 -56 51 8 52 22 0 28 4 25 18 -4
19 -42 25 -93 13z"/>
<path d="M1696 3098 c-3 -13 -6 -55 -6 -94 0 -94 7 -99 95 -77 106 28 112 79
7 55 -26 -6 -51 -8 -56 -5 -4 3 -6 26 -2 52 3 25 7 55 8 66 4 30 -37 33 -46 3z"/>
<path d="M1493 2883 c-18 -46 104 -184 201 -229 155 -71 334 -39 451 81 62 63
105 139 88 156 -16 16 -27 6 -61 -54 -35 -62 -82 -106 -155 -145 -47 -24 -62
-27 -152 -27 -82 0 -109 4 -147 22 -61 28 -141 103 -176 165 -29 51 -39 58
-49 31z"/>
<path d="M3492 2814 c-29 -20 -28 -50 3 -70 56 -37 118 32 63 70 -28 20 -38
20 -66 0z m56 -37 c2 -11 -3 -17 -17 -17 -23 0 -35 15 -26 31 10 15 39 6 43
-14z"/>
<path d="M3640 2812 c-47 -38 15 -101 66 -67 29 19 30 39 4 65 -25 25 -41 25
-70 2z m56 -23 c9 -16 -12 -33 -31 -25 -14 5 -15 9 -5 21 15 18 26 19 36 4z"/>
<path d="M2260 2180 c0 -11 -26 -194 -35 -247 -5 -30 -3 -33 18 -33 23 0 24 5
41 118 9 64 19 129 22 145 5 24 3 27 -20 27 -14 0 -26 -5 -26 -10z"/>
<path d="M1445 2148 c-2 -7 -9 -51 -15 -98 -6 -47 -13 -100 -17 -117 l-5 -33
65 0 c50 0 66 4 71 16 9 24 9 24 -32 24 -21 0 -41 2 -44 5 -3 3 1 43 8 88 19
114 18 127 -6 127 -11 0 -22 -6 -25 -12z"/>
<path d="M2481 2063 c-7 -54 -15 -113 -18 -130 l-5 -33 75 0 c71 0 87 6 87 36
0 2 -25 4 -55 4 -50 0 -55 2 -55 23 0 58 9 67 66 67 41 0 54 4 54 15 0 11 -12
15 -50 15 -49 0 -50 1 -50 30 0 28 1 29 57 32 46 2 59 7 61 21 3 15 -6 17 -76
17 l-80 0 -11 -97z"/>
<path d="M2916 2124 c-3 -9 -6 -27 -6 -40 0 -15 -6 -24 -15 -24 -17 0 -20 -27
-4 -32 9 -3 9 -20 2 -61 -11 -61 -9 -67 18 -67 17 0 20 7 34 93 4 28 11 37 25
37 11 0 20 7 20 15 0 8 -7 15 -15 15 -11 0 -15 11 -15 40 0 33 -4 40 -19 40
-10 0 -22 -7 -25 -16z"/>
<path d="M3517 2104 c-8 -8 1 -24 14 -24 5 0 9 7 9 15 0 15 -12 20 -23 9z"/>
<path d="M1605 2035 c-36 -35 -34 -88 2 -112 32 -22 103 -24 127 -4 26 22 4
36 -35 22 -27 -9 -37 -8 -58 6 -26 18 -26 18 52 21 l79 3 -6 27 c-10 41 -42
62 -93 62 -33 0 -50 -6 -68 -25z m105 -20 c11 -13 6 -15 -34 -15 -25 0 -46 4
-46 9 0 23 62 27 80 6z"/>
<path d="M1824 1975 c17 -47 33 -85 36 -85 3 0 34 38 68 85 l62 85 -30 0 c-24
0 -34 -8 -56 -47 -30 -50 -28 -50 -54 20 -7 19 -16 27 -34 27 l-24 0 32 -85z"/>
<path d="M2025 2035 c-36 -35 -34 -88 2 -112 32 -22 103 -24 127 -4 26 22 4
36 -35 22 -27 -9 -37 -8 -58 6 -26 18 -26 18 52 21 l79 3 -6 27 c-10 41 -42
62 -93 62 -33 0 -50 -6 -68 -25z m105 -20 c11 -13 6 -15 -34 -15 -25 0 -46 4
-46 9 0 23 62 27 80 6z"/>
<path d="M2675 2002 c-3 -32 -9 -68 -12 -80 -5 -20 -2 -23 18 -20 20 2 25 12
34 53 13 64 20 75 52 75 25 0 25 0 18 -65 -6 -61 -5 -65 14 -65 26 0 28 4 36
71 9 75 -4 88 -89 88 l-64 -1 -7 -56z"/>
<path d="M3038 2044 c-31 -16 -44 -51 -34 -90 13 -49 122 -70 155 -30 18 21
-5 30 -39 16 -21 -9 -34 -9 -49 0 -38 20 -22 30 49 30 64 0 70 2 70 20 0 12
-11 32 -25 45 -28 29 -84 33 -127 9z m86 -20 c31 -12 15 -24 -30 -24 -40 0
-45 2 -34 15 13 16 38 19 64 9z"/>
<path d="M3245 2048 c-8 -26 -22 -138 -17 -143 3 -3 13 -5 23 -5 14 0 19 11
25 48 8 60 20 82 44 82 25 0 50 10 50 21 0 14 -120 11 -125 -3z"/>
<path d="M3507 2043 c-12 -19 -11 -87 0 -90 12 -4 17 9 26 70 4 25 -14 39 -26
20z"/>
<path d="M3566 2028 c-9 -36 -7 -78 4 -78 11 0 14 7 25 53 4 20 11 27 23 25
13 -3 16 -12 14 -42 -5 -50 20 -45 29 7 7 45 -4 57 -52 57 -30 0 -38 -4 -43
-22z"/>
<path d="M3708 2039 c-43 -25 3 -100 52 -84 24 8 27 27 3 24 -37 -3 -44 1 -41
24 2 18 9 22 36 20 21 -1 32 3 29 10 -5 16 -57 20 -79 6z"/>
<path d="M3810 1976 c0 -9 5 -16 10 -16 6 0 10 4 10 9 0 6 -4 13 -10 16 -5 3
-10 -1 -10 -9z"/>
</g>
</svg>
`,
});
</script>
